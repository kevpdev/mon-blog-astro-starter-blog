---
import { getCollection } from 'astro:content';
import Container from '../components/ui/Container.astro';
import Hero from '../components/ui/Hero.astro';
import PostCard from '../components/ui/PostCard.astro';
import Section from '../components/ui/Section.astro';
import BaseLayout from './BaseLayout.astro';

export interface Props {
  title: string;
  description: string;
}

const { title, description } = Astro.props;

const posts = (await getCollection('blog'))
  .filter((post) => {
    // Exclure les articles avec le tag "avis-formation"
    const hasTags = post.data.tags && Array.isArray(post.data.tags);
    return !hasTags || !post.data.tags.includes('avis-formation');
  })
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Featured post (most recent)
const featuredPost = posts[0];
const otherPosts = posts.slice(1);
---

<BaseLayout
  title={title}
  description={description}>
  <Hero
    title="Blog"
    subtitle="Découvrez nos derniers articles sur le développement web, Astro et les technologies modernes"
    centered={true}
  />

  <Section>
    <Container size="xl">
      {
        featuredPost && (
          <div class="mb-12">
            <h2 class="text-2xl font-semibold mb-6 text-center">Article à la une</h2>
            <PostCard
              post={featuredPost}
              class="max-w-2xl mx-auto"
            />
          </div>
        )
      }

      {
        otherPosts.length > 0 && (
          <div>
            <h2 class="text-2xl font-semibold mb-8 text-center">Tous les articles</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
              {otherPosts.map((post) => (
                <PostCard post={post} />
              ))}
            </div>
          </div>
        )
      }

      {
        posts.length === 0 && (
          <div class="text-center py-12">
            <h2 class="text-2xl font-semibold mb-4">Aucun article disponible</h2>
            <p class="text-[rgb(var(--text-secondary))]">
              Les articles seront bientôt disponibles. Revenez plus tard !
            </p>
          </div>
        )
      }
    </Container>
  </Section>
</BaseLayout>
